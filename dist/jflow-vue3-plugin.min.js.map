{"version":3,"file":"jflow-vue3-plugin.min.js","sources":["../components/useStack.js","../components/event-utils.js","../components/JFlow.vue","../components/useLinkStack.js","../node_modules/object-diff/index.js","../components/JFlowInstance.js","../components/JFlowLink.js","../components/JFlowGroup.js","../components/JFlowTextGroup.vue","../index.js","../components/JFlowLinkGroup.js"],"sourcesContent":["import { provide } from 'vue'\nexport default function (_jflowInstance) {\n    // const stack = ref([]);\n    function addToStack(instance, source) {\n        _jflowInstance.addToStack(instance);\n        if(source) {\n            instance._jflow.setRenderNodeBySource(source, instance)\n        }\n    }\n    function removeFromStack(instance) {\n        _jflowInstance.removeFromStack(instance);\n    }\n\n    provide('addToStack', addToStack);\n    provide('removeFromStack', removeFromStack);\n}","function lowerFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nexport function bindEvent(_jflowInstance, attrs) {\n    Object.keys(attrs).map(key => {\n        if(/^on[A-Z]/.test(key)) {\n            // TODO 整理固定的 Event\n            let func = attrs[key];\n            if(Array.isArray(func)) {\n                func = func.find(f => Object.toString.call(f) === '[object Function]')\n            }\n            if(func) {\n                const reg = /^on(.*)/.exec(key);\n                if(reg[1]) {\n                    _jflowInstance.addEventListener(lowerFirstLetter(reg[1]), func);\n                }\n            }\n        }\n    })\n}","<script setup>\n    import { \n        ref, h, provide, \n        onUnmounted, \n        useAttrs, \n        nextTick, toRefs,\n        toRaw\n    } from \"vue\";\n    import useStack from \"./useStack\";\n    import useLinkStack from './useLinkStack';\n    import { bindEvent } from './event-utils'\n    import JFlow from '@joskii/jflow-core';\n    \n    const props = defineProps({\n        configs: {\n            type: Object,\n            default: function () {\n                return {};\n            },\n        },\n        loading: Boolean,\n        genVueComponentKey: {\n            type: Function,\n        }\n    });\n    defineOptions({\n        inheritAttrs: false\n    })\n    const { genVueComponentKey } = toRefs(props);\n    const genLinkVueComponentKey = (meta) => {\n        const k1 = props.genVueComponentKey(meta.from.source);\n        const k2 = props.genVueComponentKey(meta.to.source);\n        const k3 = meta.part;\n        return `${k1}-${k2}-${k3}`\n    }\n    const attrs = useAttrs();\n    const className = attrs.class;\n    const style = attrs.style;\n    const emit = defineEmits(['update:loading'])\n    const root = ref(null);\n    \n  \n    const renderNodes = ref([]);\n    const renderLinks = ref([]);\n\n    const _jflowInstance = new JFlow(toRaw(props.configs));\n    useStack(_jflowInstance);\n    useLinkStack(_jflowInstance);\n\n    const genNodeLinkMeta = () => {\n        const nodes = _jflowInstance._layout.flowStack.map(meta => {\n            const { type, layoutNode, source } = meta;\n            const map = _jflowInstance.source_Layout_Render_NodeMap;\n            let obj;\n            if(map.has(source)) {\n                obj = map.get(source);\n            } else {\n                obj = map.set(source);\n            }\n            obj.layoutNode = layoutNode;\n            return meta;\n        });\n        const links = _jflowInstance._layout.flowLinkStack.slice();\n        return [ nodes, links ];\n    }\n\n    const mountJFlow = () => {\n        console.log(renderNodes)\n        _jflowInstance.$mount(root.value);\n        bindEvent(_jflowInstance, attrs);\n        emit('update:loading', false)\n    }\n\n    onUnmounted(() => {\n        _jflowInstance?.destroy();\n    })\n\n    const syncNodeLink = (nodes, links) => {\n        renderNodes.value = nodes.slice();\n        renderLinks.value = links.slice();\n    }\n\n    syncNodeLink(...genNodeLinkMeta());\n    nextTick(() => {\n        mountJFlow();\n    })\n    \n\n    const reflow = (preCallback, afterCallback) => {\n        syncNodeLink(...genNodeLinkMeta());\n        nextTick(() => {\n            if(preCallback) {\n                preCallback();\n            }\n            _jflowInstance.recalculate();\n            _jflowInstance.scheduleRender(() => {\n                if(afterCallback) {\n                    afterCallback();\n                }\n            });\n            \n        })\n    }\n\n    const getInstance = () => {\n        return _jflowInstance;\n    }\n\n    \n    const renderJFlow = (() => {\n        let __renderInSchedule__ = false;\n        return () => {\n            if(__renderInSchedule__) {\n                return;\n            }\n            __renderInSchedule__= true;\n            nextTick(() => {\n                _jflowInstance._render();\n                __renderInSchedule__ = false;\n            });\n        }\n    })();\n\n    provide('getJFlow', getInstance);\n    provide('renderJFlow', renderJFlow);\n\n    defineExpose({\n        reflow,\n        renderJFlow,\n        getInstance,\n    });\n\n</script>\n\n<template>\n    <div ref=\"root\" :class=\"className\" :style=\"style\">\n        <slot v-if=\"!renderNodes.length\"></slot>\n        <template v-else>\n            <div>\n                <template v-for=\"node in renderNodes\" :key=\"genVueComponentKey(node.source)\">\n                    <slot \n                        :name=\"node.type\" \n                        :source=\"node.source\"\n                        :layoutNode=\"node.layoutNode\">\n                    </slot>\n                </template>\n                <template v-for=\"link in renderLinks\"  :key=\"genLinkVueComponentKey(link)\">\n                    <slot \n                        :name=\"link.type || 'plainlink'\" \n                        :configs=\"link\">\n                    </slot>\n                </template>\n            </div>\n        </template> \n    </div>\n</template>","import { provide } from 'vue'\nexport default function (_jflowInstance) {\n    // const stack = ref([]);\n    function addToLinkStack(link, sourceFrom, sourceTo) {\n        _jflowInstance.addToLinkStack(link);\n        if(sourceFrom && sourceTo) {\n            _jflowInstance.addLinkNodeBySource(sourceFrom, sourceTo, link);\n        }\n    }\n    function removeFromLinkStack(link, sourceFrom, sourceTo) {\n        _jflowInstance.removeFromLinkStack(link);\n        if(sourceFrom && sourceTo) {\n            _jflowInstance.removeLinkNodeBySource(sourceFrom, sourceTo, link);\n        }\n    }\n\n    provide('addToLinkStack', addToLinkStack);\n    provide('removeFromLinkStack', removeFromLinkStack);\n}","'use strict';\n\nstrict.custom = custom;\n\nmodule.exports = strict;\n\nfunction strict(){\n\treturn diff(null, [].slice.call(arguments, 0));\n}\n\nfunction custom( opts ){\n\treturn diff(opts, [].slice.call(arguments, 1));\n}\n\nfunction diff( opts, subjects ){\n\tvar length = subjects.length;\n\tvar ref = subjects[0];\n\tvar diff = {};\n\tvar equal = opts && opts.equal || isStrictEqual;\n\tvar c;\n\tvar keys;\n\tvar keysLength;\n\tvar key;\n\tvar u;\n\n\tfor (var i = 1;i < length;i++) {\n\t\tc = subjects[i];\n\t\tkeys = Object.keys(c);\n\t\tkeysLength = keys.length;\n\n\t\tfor (u = 0;u < keysLength;u++) {\n\t\t\tkey = keys[u];\n\n\t\t\tif (!equal(c[key], ref[key]))\n\t\t\t\tdiff[key] = c[key];\n\t\t}\n\t}\n\n\treturn diff;\n}\n\nfunction isStrictEqual( a, b ){\n\treturn a === b;\n}\n","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, onUnmounted, toRaw } from 'vue';\nimport { bindEvent } from './event-utils'\nimport diff from 'object-diff';\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            }\n        },\n        setup(props, { attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            \n            const _jflowInstance =  new builder(props.configs);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n            \n            watch(() => props.configs, (val, oldVal) => {\n                const diffed = diff(val, oldVal);\n                if(Object.keys(diffed).length === 0){\n                    return;\n                }\n                _jflowInstance.setConfig(val);\n            });\n\n            watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n            onUnmounted(() => {\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            })\n            return () => null;\n        }\n    }\n}","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, toRaw, onUnmounted } from 'vue';\nimport { bindEvent } from './event-utils'\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            from: Object,\n            to: Object,\n        },\n        setup(props, { attrs }) {\n            const addToLinkStack = inject('addToLinkStack');\n            const removeFromLinkStack = inject('removeFromLinkStack');\n            const getJFlow = inject('getJFlow');\n            const jflow = getJFlow();\n\n            let _jflowInstance\n            const createInstance = (fromInstance, toInstance) => {\n                if(fromInstance && toInstance) {\n                    _jflowInstance = new builder({\n                        ...props.configs,\n                        from: fromInstance,\n                        to: toInstance,\n                    });\n                    bindEvent(_jflowInstance, attrs);\n                    addToLinkStack(_jflowInstance, toRaw(props.from), toRaw(props.to));   \n                }\n            }\n            \n\n            const refresh = () => {\n                const fromInstance = jflow.getRenderNodeBySource(toRaw(props.from));\n                const toInstance = jflow.getRenderNodeBySource(toRaw(props.to));\n                if(!_jflowInstance) {\n                    createInstance(fromInstance, toInstance);\n                } else {\n                    _jflowInstance.setConfig({\n                        ...props.configs,\n                        from: fromInstance,\n                        to: toInstance,\n                    });\n                }    \n            }\n\n            refresh();\n\n            const stop = watch(() => [props.from, props.to, props.configs], () => {\n                refresh();\n            });\n\n            onUnmounted(() => {\n                stop()\n                if(_jflowInstance) {\n                    _jflowInstance.destroy();\n                    removeFromLinkStack(_jflowInstance);\n                }\n               \n            })\n            return () => null;\n        }\n    }\n}","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, h, onMounted, onUpdated, onUnmounted, toRaw } from 'vue';\nimport useStack from './useStack';\nimport { bindEvent } from './event-utils'\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            }\n        },\n        setup(props, { slots, attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            \n            const _jflowInstance =  new builder(props.configs);\n            useStack(_jflowInstance);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n            \n            const stop0 = watch(() => props.configs, (val, oldVal) => {\n                if(JSON.stringify(val) === JSON.stringify(oldVal)){\n                    return;\n                }\n                _jflowInstance.setConfig(val);\n            });\n\n            const stop1 = watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            const stop2 = watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n\n            onMounted(() => {\n                _jflowInstance.recalculate()\n            });\n            onUpdated(() => {\n                _jflowInstance.recalculateUp()\n            });\n            onUnmounted(() => {\n                stop0();\n                stop1();\n                stop2();\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            })\n            \n            return () => h('jflow-group', slots.default())\n        }\n    }\n}","<script setup>\n    import {\n        ref, h, provide,\n        useAttrs,\n        nextTick, toRefs,\n        toRaw,\n        inject,\n        watch,\n        onMounted,\n        onUpdated,\n        onUnmounted,\n    } from \"vue\";\n    import * as jflow from '@joskii/jflow-core';\n    import useStack from \"./useStack\";\n    import { bindEvent } from './event-utils'\n\n    const props = defineProps({\n        configs: {\n            type: Object,\n            default: function () {\n                return {};\n            },\n        },\n        visible: {\n            type: Boolean,\n            default: true,\n        },\n        source: {\n            type: Object,\n        },\n        genVueComponentKey: {\n            type: Function,\n        }\n    });\n    defineOptions({\n        inheritAttrs: false\n    })\n    const { genVueComponentKey } = toRefs(props);\n    const nodes = ref([]);\n    const attrs = useAttrs();\n\n    const addToBelongStack = inject('addToStack');\n    const removeFromBelongStack = inject('removeFromStack');\n\n    const _jflowInstance = new TextGroup(toRaw(props.configs));\n    useStack(_jflowInstance);\n    bindEvent(_jflowInstance, attrs);\n    addToBelongStack(_jflowInstance, toRaw(props.source));\n    \n    const genTextElementMeta = () => {\n        nodes.value = _jflowInstance._flattenTxtElem.filter(elem => elem.type !== 'text');\n    }\n\n    genTextElementMeta();\n\n    const stop0 = watch(() => props.configs, (val, oldVal) => {\n        if (JSON.stringify(val) === JSON.stringify(oldVal)) {\n            return;\n        }\n        _jflowInstance.setConfig(val);\n    });\n\n    const stop1 = watch(() => props.visible, (val) => {\n        _jflowInstance.visible = val;\n    });\n\n    const stop2 = watch(() => props.source, (val) => {\n        _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n    });\n\n    \n\n    const reflow = () => {\n        _jflowInstance.refreshTextElements();\n        genTextElementMeta();\n        nextTick(() => {\n            _jflowInstance.refresh();\n        })\n    }\n\n    onMounted(() => {\n        _jflowInstance.recalculate()\n    });\n    onUpdated(() => {\n        _jflowInstance.recalculateUp()\n    });\n    onUnmounted(() => {\n        stop0();\n        stop1();\n        stop2();\n        _jflowInstance.destroy();\n        removeFromBelongStack(_jflowInstance);\n    });\n\n    const getInstance = () => {\n        return _jflowInstance;\n    }\n\n    defineExpose({\n        reflow,\n        getInstance\n    });\n\n</script>\n<template>\n    <jflow-group>\n        <template v-for=\"node in nodes\" :key=\"genVueComponentKey(node.source)\">\n            <slot :name=\"node.type || 'jflowcommon'\" :source=\"node.source\" :textElement=\"node\">\n            </slot>\n        </template>\n    </jflow-group>\n</template>","import JFlowComponent from './components/JFlow.vue';\nimport JFlowInstance from './components/JFlowInstance';\nimport JFlowLink from './components/JFlowLink';\nimport JFlowGroup from './components/JFlowGroup';\nimport JFlowTextGroup from './components/JFlowTextGroup.vue';\n\nconst JFLOW_NODES = [\n    'Point',\n    'Rectangle',\n    'Capsule',\n    'Diamond',\n    'Rhombus',\n    'Text',\n    'Icon',\n    'ShadowDom',\n    'TextEditor',\n];\nconst JFLOW_LINKS = [\n    'Link',\n    'PolyLink',\n    'BezierLink'\n]\nconst JFLOW_GROUPS = [\n    'CapsuleGroup',\n    'CapsuleVerticalGroup',\n    'DiamondGroup',\n    'DiamondVerticalGroup',\n    'RhombusGroup',\n    'PointGroup',\n    'ScrollGroup',\n]\n\nconst components = [\n    {\n        name: 'Jflow',\n        component: JFlowComponent,\n    },\n    {\n        name: 'Group',\n        component: JFlowGroup('Group'),\n    }, \n    ...JFLOW_GROUPS.map(name => ({\n        name,\n        component: JFlowGroup(name)\n    })),\n    ...JFLOW_NODES.map(name => ({\n        name,\n        component: JFlowInstance(name)\n    })),\n    ...JFLOW_LINKS.map(name => ({\n        name,\n        component: JFlowLink(name)\n    })),\n    {\n        name: 'TextGroup',\n        component: JFlowTextGroup\n    }\n];\nconst componentPrefix = 'j';\ncustomElements.define('jflow-group', class extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({mode: 'open'});\n    }\n});\n/**\n * @module JFlowVuePlugin \n */\nexport const JFlowVuePlugin = {\n    /**\n     * 安装 JFlowVuePlugin\n     * @function\n     * @param {Vue} Vue - Vue\n     * @param {Object} options - Vue plugin 配置\n     * @param {string} options.prefix - 组件前缀，默认是 j\n     * @param {Object} options.custom - 自定义组件，形式为 { key: {@link:Instance} }\n     */\n    install: (Vue, options = {}) => {\n        let prefixToUse = componentPrefix;\n        if(options && options.prefix){\n            prefixToUse = options.prefix;\n        };\n        components.forEach(k => {\n            Vue.component(`${prefixToUse}${k.name}`, k.component);\n        });\n\n        if(options.customInstance) {\n            Object.keys(options.customInstance).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowInstance(options.customInstance[name]));\n            })\n        }\n        if(options.customGroups) {\n            Object.keys(options.customGroups).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowGroup(options.customGroups[name]));\n            })\n        }\n        if(options.customLink) {\n            Object.keys(options.customLink).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowLink(options.customLink[name]));\n            })\n        }\n    }\n}\n\nexport { default as JFlowLinkGroup } from './components/JFlowLinkGroup';\n","import { inject, watch, onMounted, onUpdated, onUnmounted, toRaw } from 'vue';\nimport useStack from './useStack';\nimport { bindEvent } from './event-utils'\n\nexport default function (builder) {\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            },\n            genVueComponentKey: {\n                type: Function,\n            }\n        },\n        data() {\n            return {\n                renderLinks: [],\n            }\n        },\n        setup(props, { attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            const _jflowInstance =  new builder(props.configs);\n            useStack(_jflowInstance);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n\n            const genLinks = () => {\n                this.renderLinks = _jflowInstance._layout.flowLinkStack.slice();\n            }\n\n            genLinks();\n            const stop1 = watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            const stop2 = watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n            onMounted(() => {\n                _jflowInstance.recalculate()\n            });\n            onUpdated(() => {\n                _jflowInstance.recalculateUp()\n            });\n            onUnmounted(() => {\n                stop1();\n                stop2();\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            });\n\n           \n        },\n        methods: {\n            genLinkVueComponentKey(meta) {\n                const k1 = this.genVueComponentKey(meta.from.source);\n                const k2 = this.genVueComponentKey(meta.to.source);\n                const k3 = meta.part;\n                return `${k1}-${k2}-${k3}`\n            },\n            \n        },\n        template: `\n            <jflow-group>\n                <slot></slot>\n                <template v-for=\"link in renderLinks\" :key=\"genLinkVueComponentKey(link)\">\n                    <slot :name=\"link.type || 'plainlink'\" \n                        :configs=\"link\">\n                    </slot>\n                </template>\n            </jflow-group>\n        ` \n    }\n}"],"names":["useStack","_jflowInstance","provide","instance","source","addToStack","_jflow","setRenderNodeBySource","removeFromStack","bindEvent","attrs","Object","keys","map","key","test","func","Array","isArray","find","f","toString","call","reg","exec","addEventListener","string","charAt","toLowerCase","slice","genVueComponentKey","toRefs","props","useAttrs","className","style","root","ref","renderNodes","renderLinks","JFlow","toRaw","configs","link","sourceFrom","sourceTo","addToLinkStack","addLinkNodeBySource","removeFromLinkStack","removeLinkNodeBySource","useLinkStack","genNodeLinkMeta","_layout","flowStack","meta","type","layoutNode","source_Layout_Render_NodeMap","has","get","set","flowLinkStack","onUnmounted","destroy","syncNodeLink","nodes","links","value","apply","_toConsumableArray","nextTick","console","log","$mount","emit","__renderInSchedule__","getInstance","renderJFlow","_render","__expose","reflow","preCallback","afterCallback","recalculate","scheduleRender","k1","from","k2","to","k3","part","concat","strict","diff","arguments","opts","subjects","c","keysLength","u","length","equal","isStrictEqual","i","a","b","custom","JFlowInstance","nameNode","builder","inheritAttrs","default","visible","Boolean","setup","_ref","addToBelongStack","inject","removeFromBelongStack","watch","val","oldVal","diffed","setConfig","JFlowLink","jflow","getJFlow","refresh","fromInstance","getRenderNodeBySource","toInstance","_objectSpread","createInstance","stop","JFlowGroup","slots","stop0","JSON","stringify","stop1","stop2","onMounted","onUpdated","recalculateUp","h","TextGroup","genTextElementMeta","_flattenTxtElem","filter","elem","refreshTextElements","components","name","component","JFlowComponent","JFlowTextGroup","customElements","define","_HTMLElement","_inherits","_class","_super","_this","_classCallCheck","this","attachShadow","mode","_wrapNativeSuper","HTMLElement","JFlowVuePlugin","install","Vue","options","undefined","prefixToUse","prefix","forEach","k","customInstance","customGroups","customLink","Function","data","methods","genLinkVueComponentKey","template"],"mappings":"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"}