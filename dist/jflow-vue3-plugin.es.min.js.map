{"version":3,"file":"jflow-vue3-plugin.es.min.js","sources":["../components/useStack.js","../components/event-utils.js","../components/JFlow.vue","../components/useLinkStack.js","../node_modules/object-diff/index.js","../components/JFlowInstance.js","../components/JFlowLink.js","../components/JFlowGroup.js","../components/JFlowTextGroup.vue","../components/JFlowLinkGroup.js","../index.js"],"sourcesContent":["import { provide } from 'vue'\nexport default function (_jflowInstance) {\n    // const stack = ref([]);\n    function addToStack(instance, source) {\n        _jflowInstance.addToStack(instance);\n        if(source) {\n            instance._jflow.setRenderNodeBySource(source, instance)\n        }\n    }\n    function removeFromStack(instance) {\n        _jflowInstance.removeFromStack(instance);\n    }\n\n    provide('addToStack', addToStack);\n    provide('removeFromStack', removeFromStack);\n}","function lowerFirstLetter(string) {\n    return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nexport function bindEvent(_jflowInstance, attrs) {\n    Object.keys(attrs).map(key => {\n        if(/^on[A-Z]/.test(key)) {\n            // TODO 整理固定的 Event\n            let func = attrs[key];\n            if(Array.isArray(func)) {\n                func = func.find(f => Object.toString.call(f) === '[object Function]')\n            }\n            if(func) {\n                const reg = /^on(.*)/.exec(key);\n                if(reg[1]) {\n                    _jflowInstance.addEventListener(lowerFirstLetter(reg[1]), func);\n                }\n            }\n        }\n    })\n}","<script setup>\n    import { \n        ref, h, provide, \n        onUnmounted, \n        useAttrs, \n        nextTick, toRefs,\n        toRaw\n    } from \"vue\";\n    import useStack from \"./useStack\";\n    import useLinkStack from './useLinkStack';\n    import { bindEvent } from './event-utils'\n    import JFlow from '@joskii/jflow-core';\n    \n    const props = defineProps({\n        configs: {\n            type: Object,\n            default: function () {\n                return {};\n            },\n        },\n        loading: Boolean,\n        genVueComponentKey: {\n            type: Function,\n        }\n    });\n    defineOptions({\n        inheritAttrs: false\n    })\n    const { genVueComponentKey } = toRefs(props);\n    const genLinkVueComponentKey = (meta) => {\n        const k1 = props.genVueComponentKey(meta.from.source);\n        const k2 = props.genVueComponentKey(meta.to.source);\n        const k3 = meta.part;\n        return `${k1}-${k2}-${k3}`\n    }\n    const attrs = useAttrs();\n    const className = attrs.class;\n    const style = attrs.style;\n    const emit = defineEmits(['update:loading'])\n    const root = ref(null);\n    \n  \n    const renderNodes = ref([]);\n    const renderLinks = ref([]);\n\n    const _jflowInstance = new JFlow(toRaw(props.configs));\n    useStack(_jflowInstance);\n    useLinkStack(_jflowInstance);\n\n    const genNodeLinkMeta = () => {\n        const nodes = _jflowInstance._layout.flowStack.map(meta => {\n            const { type, layoutNode, source } = meta;\n            const map = _jflowInstance.source_Layout_Render_NodeMap;\n            let obj;\n            if(map.has(source)) {\n                obj = map.get(source);\n            } else {\n                obj = map.set(source);\n            }\n            obj.layoutNode = layoutNode;\n            return meta;\n        });\n        const links = _jflowInstance._layout.flowLinkStack.slice();\n        return [ nodes, links ];\n    }\n\n    const mountJFlow = () => {\n        console.log(renderNodes)\n        _jflowInstance.$mount(root.value);\n        bindEvent(_jflowInstance, attrs);\n        emit('update:loading', false)\n    }\n\n    onUnmounted(() => {\n        _jflowInstance?.destroy();\n    })\n\n    const syncNodeLink = (nodes, links) => {\n        renderNodes.value = nodes.slice();\n        renderLinks.value = links.slice();\n    }\n\n    syncNodeLink(...genNodeLinkMeta());\n    nextTick(() => {\n        mountJFlow();\n    })\n    \n\n    const reflow = (preCallback, afterCallback) => {\n        syncNodeLink(...genNodeLinkMeta());\n        nextTick(() => {\n            if(preCallback) {\n                preCallback();\n            }\n            _jflowInstance.recalculate();\n            _jflowInstance.scheduleRender(() => {\n                if(afterCallback) {\n                    afterCallback();\n                }\n            });\n            \n        })\n    }\n\n    const getInstance = () => {\n        return _jflowInstance;\n    }\n\n    \n    const renderJFlow = (() => {\n        let __renderInSchedule__ = false;\n        return () => {\n            if(__renderInSchedule__) {\n                return;\n            }\n            __renderInSchedule__= true;\n            nextTick(() => {\n                _jflowInstance._render();\n                __renderInSchedule__ = false;\n            });\n        }\n    })();\n\n    provide('getJFlow', getInstance);\n    provide('renderJFlow', renderJFlow);\n\n    defineExpose({\n        reflow,\n        renderJFlow,\n        getInstance,\n    });\n\n</script>\n\n<template>\n    <div ref=\"root\" :class=\"className\" :style=\"style\">\n        <slot v-if=\"!renderNodes.length\"></slot>\n        <template v-else>\n            <div>\n                <template v-for=\"node in renderNodes\" :key=\"genVueComponentKey(node.source)\">\n                    <slot \n                        :name=\"node.type\" \n                        :source=\"node.source\"\n                        :layoutNode=\"node.layoutNode\">\n                    </slot>\n                </template>\n                <template v-for=\"link in renderLinks\"  :key=\"genLinkVueComponentKey(link)\">\n                    <slot \n                        :name=\"link.type || 'plainlink'\" \n                        :configs=\"link\">\n                    </slot>\n                </template>\n            </div>\n        </template> \n    </div>\n</template>","import { provide } from 'vue'\nexport default function (_jflowInstance) {\n    // const stack = ref([]);\n    function addToLinkStack(link, sourceFrom, sourceTo) {\n        _jflowInstance.addToLinkStack(link);\n        if(sourceFrom && sourceTo) {\n            _jflowInstance.addLinkNodeBySource(sourceFrom, sourceTo, link);\n        }\n    }\n    function removeFromLinkStack(link, sourceFrom, sourceTo) {\n        _jflowInstance.removeFromLinkStack(link);\n        if(sourceFrom && sourceTo) {\n            _jflowInstance.removeLinkNodeBySource(sourceFrom, sourceTo, link);\n        }\n    }\n\n    provide('addToLinkStack', addToLinkStack);\n    provide('removeFromLinkStack', removeFromLinkStack);\n}","'use strict';\n\nstrict.custom = custom;\n\nmodule.exports = strict;\n\nfunction strict(){\n\treturn diff(null, [].slice.call(arguments, 0));\n}\n\nfunction custom( opts ){\n\treturn diff(opts, [].slice.call(arguments, 1));\n}\n\nfunction diff( opts, subjects ){\n\tvar length = subjects.length;\n\tvar ref = subjects[0];\n\tvar diff = {};\n\tvar equal = opts && opts.equal || isStrictEqual;\n\tvar c;\n\tvar keys;\n\tvar keysLength;\n\tvar key;\n\tvar u;\n\n\tfor (var i = 1;i < length;i++) {\n\t\tc = subjects[i];\n\t\tkeys = Object.keys(c);\n\t\tkeysLength = keys.length;\n\n\t\tfor (u = 0;u < keysLength;u++) {\n\t\t\tkey = keys[u];\n\n\t\t\tif (!equal(c[key], ref[key]))\n\t\t\t\tdiff[key] = c[key];\n\t\t}\n\t}\n\n\treturn diff;\n}\n\nfunction isStrictEqual( a, b ){\n\treturn a === b;\n}\n","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, onUnmounted, toRaw } from 'vue';\nimport { bindEvent } from './event-utils'\nimport diff from 'object-diff';\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            }\n        },\n        setup(props, { attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            \n            const _jflowInstance =  new builder(props.configs);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n            \n            watch(() => props.configs, (val, oldVal) => {\n                const diffed = diff(val, oldVal);\n                if(Object.keys(diffed).length === 0){\n                    return;\n                }\n                _jflowInstance.setConfig(val);\n            });\n\n            watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n            onUnmounted(() => {\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            })\n            return () => null;\n        }\n    }\n}","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, toRaw, onUnmounted } from 'vue';\nimport { bindEvent } from './event-utils'\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            from: Object,\n            to: Object,\n        },\n        setup(props, { attrs }) {\n            const addToLinkStack = inject('addToLinkStack');\n            const removeFromLinkStack = inject('removeFromLinkStack');\n            const getJFlow = inject('getJFlow');\n            const jflow = getJFlow();\n\n            let _jflowInstance\n            const createInstance = (fromInstance, toInstance) => {\n                if(fromInstance && toInstance) {\n                    _jflowInstance = new builder({\n                        ...props.configs,\n                        from: fromInstance,\n                        to: toInstance,\n                    });\n                    bindEvent(_jflowInstance, attrs);\n                    addToLinkStack(_jflowInstance, toRaw(props.from), toRaw(props.to));   \n                }\n            }\n            \n\n            const refresh = () => {\n                const fromInstance = jflow.getRenderNodeBySource(toRaw(props.from));\n                const toInstance = jflow.getRenderNodeBySource(toRaw(props.to));\n                if(!_jflowInstance) {\n                    createInstance(fromInstance, toInstance);\n                } else {\n                    _jflowInstance.setConfig({\n                        ...props.configs,\n                        from: fromInstance,\n                        to: toInstance,\n                    });\n                }    \n            }\n\n            refresh();\n\n            const stop = watch(() => [props.from, props.to, props.configs], () => {\n                refresh();\n            });\n\n            onUnmounted(() => {\n                stop()\n                if(_jflowInstance) {\n                    _jflowInstance.destroy();\n                    removeFromLinkStack(_jflowInstance);\n                }\n               \n            })\n            return () => null;\n        }\n    }\n}","import * as JFlowInstance from '@joskii/jflow-core';\nimport { inject, watch, h, onMounted, onUpdated, onUnmounted, toRaw } from 'vue';\nimport useStack from './useStack';\nimport { bindEvent } from './event-utils'\n\nexport default function (nameNode) {\n    const builder =  typeof nameNode === 'string'\n        ? JFlowInstance[nameNode]\n        : nameNode;\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            }\n        },\n        setup(props, { slots, attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            \n            const _jflowInstance =  new builder(props.configs);\n            useStack(_jflowInstance);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n            \n            const stop0 = watch(() => props.configs, (val, oldVal) => {\n                if(JSON.stringify(val) === JSON.stringify(oldVal)){\n                    return;\n                }\n                _jflowInstance.setConfig(val);\n            });\n\n            const stop1 = watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            const stop2 = watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n\n            onMounted(() => {\n                _jflowInstance.recalculate()\n            });\n            onUpdated(() => {\n                _jflowInstance.recalculateUp()\n            });\n            onUnmounted(() => {\n                stop0();\n                stop1();\n                stop2();\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            })\n            \n            return () => h('jflow-group', slots.default())\n        }\n    }\n}","<script setup>\n    import {\n        ref, h, provide,\n        useAttrs,\n        nextTick, toRefs,\n        toRaw,\n        inject,\n        watch,\n        onMounted,\n        onUpdated,\n        onUnmounted,\n    } from \"vue\";\n    import * as jflow from '@joskii/jflow-core';\n    import useStack from \"./useStack\";\n    import { bindEvent } from './event-utils'\n\n    const props = defineProps({\n        configs: {\n            type: Object,\n            default: function () {\n                return {};\n            },\n        },\n        visible: {\n            type: Boolean,\n            default: true,\n        },\n        source: {\n            type: Object,\n        },\n        genVueComponentKey: {\n            type: Function,\n        }\n    });\n    defineOptions({\n        inheritAttrs: false\n    })\n    const { genVueComponentKey } = toRefs(props);\n    const nodes = ref([]);\n    const attrs = useAttrs();\n\n    const addToBelongStack = inject('addToStack');\n    const removeFromBelongStack = inject('removeFromStack');\n\n    const _jflowInstance = new TextGroup(toRaw(props.configs));\n    useStack(_jflowInstance);\n    bindEvent(_jflowInstance, attrs);\n    addToBelongStack(_jflowInstance, toRaw(props.source));\n    \n    const genTextElementMeta = () => {\n        nodes.value = _jflowInstance._flattenTxtElem.filter(elem => elem.type !== 'text');\n    }\n\n    genTextElementMeta();\n\n    const stop0 = watch(() => props.configs, (val, oldVal) => {\n        if (JSON.stringify(val) === JSON.stringify(oldVal)) {\n            return;\n        }\n        _jflowInstance.setConfig(val);\n    });\n\n    const stop1 = watch(() => props.visible, (val) => {\n        _jflowInstance.visible = val;\n    });\n\n    const stop2 = watch(() => props.source, (val) => {\n        _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n    });\n\n    \n\n    const reflow = () => {\n        _jflowInstance.refreshTextElements();\n        genTextElementMeta();\n        nextTick(() => {\n            _jflowInstance.refresh();\n        })\n    }\n\n    onMounted(() => {\n        _jflowInstance.recalculate()\n    });\n    onUpdated(() => {\n        _jflowInstance.recalculateUp()\n    });\n    onUnmounted(() => {\n        stop0();\n        stop1();\n        stop2();\n        _jflowInstance.destroy();\n        removeFromBelongStack(_jflowInstance);\n    });\n\n    const getInstance = () => {\n        return _jflowInstance;\n    }\n\n    defineExpose({\n        reflow,\n        getInstance\n    });\n\n</script>\n<template>\n    <jflow-group>\n        <template v-for=\"node in nodes\" :key=\"genVueComponentKey(node.source)\">\n            <slot :name=\"node.type || 'jflowcommon'\" :source=\"node.source\" :textElement=\"node\">\n            </slot>\n        </template>\n    </jflow-group>\n</template>","import { inject, watch, onMounted, onUpdated, onUnmounted, toRaw } from 'vue';\nimport useStack from './useStack';\nimport { bindEvent } from './event-utils'\n\nexport default function (builder) {\n    return {\n        inheritAttrs: false,\n        props: {\n            configs: {\n                type: Object,\n                default: function () {\n                    return {};\n                },\n            },\n            visible: {\n                type: Boolean,\n                default: true,\n            },\n            source: {\n                type: Object,\n            },\n            genVueComponentKey: {\n                type: Function,\n            }\n        },\n        data() {\n            return {\n                renderLinks: [],\n            }\n        },\n        setup(props, { attrs }) {\n            const addToBelongStack = inject('addToStack');\n            const removeFromBelongStack = inject('removeFromStack');\n            const _jflowInstance =  new builder(props.configs);\n            useStack(_jflowInstance);\n            bindEvent(_jflowInstance, attrs);\n            addToBelongStack(_jflowInstance, toRaw(props.source));\n\n            const genLinks = () => {\n                this.renderLinks = _jflowInstance._layout.flowLinkStack.slice();\n            }\n\n            genLinks();\n            const stop1 = watch(() => props.visible, (val) => {\n                _jflowInstance.visible = val;\n            });\n\n            const stop2 = watch(() => props.source, (val) => {\n                _jflowInstance._jflow.setRenderNodeBySource(val, _jflowInstance);\n            });\n\n            onMounted(() => {\n                _jflowInstance.recalculate()\n            });\n            onUpdated(() => {\n                _jflowInstance.recalculateUp()\n            });\n            onUnmounted(() => {\n                stop1();\n                stop2();\n                _jflowInstance.destroy();\n                removeFromBelongStack(_jflowInstance);\n            });\n\n           \n        },\n        methods: {\n            genLinkVueComponentKey(meta) {\n                const k1 = this.genVueComponentKey(meta.from.source);\n                const k2 = this.genVueComponentKey(meta.to.source);\n                const k3 = meta.part;\n                return `${k1}-${k2}-${k3}`\n            },\n            \n        },\n        template: `\n            <jflow-group>\n                <slot></slot>\n                <template v-for=\"link in renderLinks\" :key=\"genLinkVueComponentKey(link)\">\n                    <slot :name=\"link.type || 'plainlink'\" \n                        :configs=\"link\">\n                    </slot>\n                </template>\n            </jflow-group>\n        ` \n    }\n}","import JFlowComponent from './components/JFlow.vue';\nimport JFlowInstance from './components/JFlowInstance';\nimport JFlowLink from './components/JFlowLink';\nimport JFlowGroup from './components/JFlowGroup';\nimport JFlowTextGroup from './components/JFlowTextGroup.vue';\n\nconst JFLOW_NODES = [\n    'Point',\n    'Rectangle',\n    'Capsule',\n    'Diamond',\n    'Rhombus',\n    'Text',\n    'Icon',\n    'ShadowDom',\n    'TextEditor',\n];\nconst JFLOW_LINKS = [\n    'Link',\n    'PolyLink',\n    'BezierLink'\n]\nconst JFLOW_GROUPS = [\n    'CapsuleGroup',\n    'CapsuleVerticalGroup',\n    'DiamondGroup',\n    'DiamondVerticalGroup',\n    'RhombusGroup',\n    'PointGroup',\n    'ScrollGroup',\n]\n\nconst components = [\n    {\n        name: 'Jflow',\n        component: JFlowComponent,\n    },\n    {\n        name: 'Group',\n        component: JFlowGroup('Group'),\n    }, \n    ...JFLOW_GROUPS.map(name => ({\n        name,\n        component: JFlowGroup(name)\n    })),\n    ...JFLOW_NODES.map(name => ({\n        name,\n        component: JFlowInstance(name)\n    })),\n    ...JFLOW_LINKS.map(name => ({\n        name,\n        component: JFlowLink(name)\n    })),\n    {\n        name: 'TextGroup',\n        component: JFlowTextGroup\n    }\n];\nconst componentPrefix = 'j';\ncustomElements.define('jflow-group', class extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({mode: 'open'});\n    }\n});\n/**\n * @module JFlowVuePlugin \n */\nexport const JFlowVuePlugin = {\n    /**\n     * 安装 JFlowVuePlugin\n     * @function\n     * @param {Vue} Vue - Vue\n     * @param {Object} options - Vue plugin 配置\n     * @param {string} options.prefix - 组件前缀，默认是 j\n     * @param {Object} options.custom - 自定义组件，形式为 { key: {@link:Instance} }\n     */\n    install: (Vue, options = {}) => {\n        let prefixToUse = componentPrefix;\n        if(options && options.prefix){\n            prefixToUse = options.prefix;\n        };\n        components.forEach(k => {\n            Vue.component(`${prefixToUse}${k.name}`, k.component);\n        });\n\n        if(options.customInstance) {\n            Object.keys(options.customInstance).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowInstance(options.customInstance[name]));\n            })\n        }\n        if(options.customGroups) {\n            Object.keys(options.customGroups).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowGroup(options.customGroups[name]));\n            })\n        }\n        if(options.customLink) {\n            Object.keys(options.customLink).forEach(name => {\n                Vue.component(`${prefixToUse}${name}`, JFlowLink(options.customLink[name]));\n            })\n        }\n    }\n}\n\nexport { default as JFlowLinkGroup } from './components/JFlowLinkGroup';\n"],"names":["useStack","_jflowInstance","provide","instance","source","addToStack","_jflow","setRenderNodeBySource","removeFromStack","bindEvent","attrs","Object","keys","map","key","test","func","Array","isArray","find","f","toString","call","reg","exec","addEventListener","string","charAt","toLowerCase","slice","genVueComponentKey","toRefs","props","useAttrs","className","class","style","root","ref","renderNodes","renderLinks","JFlow","toRaw","configs","link","sourceFrom","sourceTo","addToLinkStack","addLinkNodeBySource","removeFromLinkStack","removeLinkNodeBySource","useLinkStack","genNodeLinkMeta","_layout","flowStack","meta","type","layoutNode","source_Layout_Render_NodeMap","obj","has","get","set","flowLinkStack","onUnmounted","destroy","syncNodeLink","nodes","links","value","nextTick","console","log","$mount","emit","getInstance","renderJFlow","__renderInSchedule__","_render","__expose","reflow","preCallback","afterCallback","recalculate","scheduleRender","from","to","part","strict","diff","arguments","opts","subjects","c","keysLength","u","length","equal","isStrictEqual","i","a","b","custom","JFlowInstance","nameNode","builder","inheritAttrs","default","visible","Boolean","setup","addToBelongStack","inject","removeFromBelongStack","watch","val","oldVal","diffed","setConfig","JFlowLink","jflow","getJFlow","refresh","fromInstance","getRenderNodeBySource","toInstance","createInstance","stop","JFlowGroup","slots","stop0","JSON","stringify","stop1","stop2","onMounted","onUpdated","recalculateUp","h","TextGroup","genTextElementMeta","_flattenTxtElem","filter","elem","refreshTextElements","JFlowLinkGroup","Function","data","this","genLinks","methods","genLinkVueComponentKey","template","components","name","component","JFlowComponent","JFlowTextGroup","customElements","define","HTMLElement","constructor","super","attachShadow","mode","JFlowVuePlugin","install","Vue","options","prefixToUse","prefix","forEach","k","customInstance","customGroups","customLink"],"mappings":"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"}